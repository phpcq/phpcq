<project name="phpcq.task.phpcs">
    <property file="${phpcq.basedir}/tasks/phpcs/default.properties"/>
    <target name="-check-phpcs.installed" unless="phpcs.installed">
        <available property="phpcs.installed" file="${phpcq.bin.phpcs}"/>
    </target>
    <target name="phpcs" depends="-check-phpcs.installed" if="${phpcs.installed}">
        <exec executable="${php.binary}" outputproperty="phpcs.excluded.arguments">
            <arg line="-r"/>
            <arg value="
            echo ($ignored=implode(' --ignore=', array_filter(array_map('trim', explode(' ', '${phpcs.excluded}')))))
                ? '--ignore=' . $ignored
                : '';
            "/>
        </exec>
        <exec dir="${basedir}" executable="${php.binary}" failonerror="true" taskname="phpcs">
            <arg value="${phpcq.bin.phpcs}"/>
            <arg value="--standard=${phpcs.standard}"/>
            <arg line="${phpcs.customflags}"/>
            <arg line="${phpcs.excluded.arguments}"/>
            <arg line="${phpcs.src}"/>
        </exec>
    </target>
</project>
