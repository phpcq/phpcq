<project name="phpcq.task.phploc">
    <import file="../macrodefs.xml" />
    <property file="${phpcq.basedir}/tasks/phploc/default.properties"/>
    <target name="-check-phploc.is-available" unless="phpcq.task.phploc.bin">
        <find-file-in-path
            name="phploc"
            property="phpcq.task.phploc.bin"
            alternativepath="${phpcq.bin.phploc}"
        />
    </target>
    <target name="phploc" depends="-check-phploc.is-available" if="phpcq.task.phploc.bin">
        <exec executable="${php.binary}" outputproperty="phploc.excluded.arguments">
            <arg line="-r"/>
            <arg value="
            echo ($ignored=implode(' --exclude=', array_filter(array_map('trim', explode(' ', '${phploc.excluded}')))))
                ? '--exclude=' . $ignored
                : '';
            "/>
        </exec>
        <exec dir="${basedir}" executable="${php.binary}" failonerror="true" taskname="phploc">
            <arg value="${phpcq.task.phploc.bin}"/>
            <arg line="${phploc.excluded.arguments}"/>
            <arg line="${phploc.src}"/>
        </exec>
    </target>
</project>
