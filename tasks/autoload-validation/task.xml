<project name="phpcq.task.autoload-validation">
    <property file="${phpcq.basedir}/tasks/autoload-validation/default.properties"/>
    <target name="-check-autoload-validation.installed" unless="autoload-validation.installed">
        <available property="autoload-validation.installed" file="${phpcq.bin.autoload-validation}"/>
    </target>
    <target name="autoload-validation" depends="-check-autoload-validation.installed" if="${autoload-validation.installed}">
        <exec executable="${php.binary}" outputproperty="autoload-validation.excluded.arguments">
            <arg line="-r"/>
            <arg value="
                echo ($ignored=implode(' --ignore-files=', array_filter(array_map('trim', explode(' ', '${autoload-validation.excluded}')))))
                    ? '--ignore-files=' . $ignored
                    : '';
                "/>
        </exec>
        <exec dir="${basedir}" executable="${php.binary}" failonerror="true" taskname="autoload-validation">
            <arg value="${phpcq.bin.autoload-validation}"/>
            <arg value="${basedir}"/>
            <arg line="${autoload-validation.customflags}"/>
            <arg line="${autoload-validation.excluded.arguments}"/>
        </exec>
    </target>
</project>
