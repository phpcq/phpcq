<?xml version="1.0" encoding="UTF-8"?>
<!--
    This is a default build file that sits outside of any project folders, but which is imported into the project build
    file like so:
        <import file="vendor/phpcq/phpcq/phpcq.main.xml"/>

    All relative references in this file, are assumed to be from the base of the project build file.
    If an identically named target in the project build file is also present in this imported file, the one from the
    project file takes precedence. e.g. a project build file can define a different "build" target to remove the analyze
    target, for instance.
-->

<project
    name="phpcq.main"
    default="build"
    >
    <property name="phpcq.basedir" value="${basedir}/vendor/phpcq/phpcq" />

    <!-- Pull in the local properties first. -->
    <property file="${basedir}/build.properties"/>
    <!-- Pull in the project default properties next. -->
    <property file="${basedir}/build.default.properties"/>
    <!-- Pull in the global default properties -->
    <property file="${phpcq.basedir}/build.default.properties" />

    <import file="${phpcq.basedir}/tasks/macrodefs.xml" />
    <find-file-in-path
        name="php"
        property="phpcq.php-cli.bin"
        alternativepath="${php.binary}"
    />

    <!-- Import the tasks now. -->
    <import file="tasks/author-validation/task.xml" />
    <import file="tasks/autoload-validation/task.xml" />
    <import file="tasks/branch-alias-validation/task.xml" />
    <import file="tasks/composer-validate/task.xml" />
    <import file="tasks/pdepend/task.xml" />
    <import file="tasks/phplint/task.xml" />
    <import file="tasks/phpcpd/task.xml" />
    <import file="tasks/phpcs/task.xml" />
    <import file="tasks/phploc/task.xml" />
    <import file="tasks/phpmd/task.xml" />
    <import file="tasks/phpunit/task.xml" />
    <import file="tasks/phpspec/task.xml" />
    <import file="tasks/travis-configuration-check/task.xml" />
    <import file="tasks/sonarqube/task.xml" />

    <!-- Build targets from here on. -->
    <target
        name="build"
        depends="verify, analyze"
        description="Do a full build"
    />

    <target
        name="verify"
        depends="
            phplint,
            composer-validate,
            autoload-validation,
            author-validation"
        description="Verify the quality of the code"
    />

    <target
        name="analyze"
        depends="
            phploc,
            pdepend,
            phpmd,
            phpcs,
            phpcpd,
            phpunit,
            phpspec,
            branch-alias-validation,
            travis-configuration-check"
        description="Do static analysis of the code"
    />
<!--
    <target
        name="docs"
        depends="phpdoc, phpcb, htaccess, copysvg, copybuild"
    />
-->
</project>
